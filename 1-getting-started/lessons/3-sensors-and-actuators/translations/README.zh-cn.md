# 通过传感器和执行器与物理世界交互

![本课的 sketchnote 概述](../../../../sketchnotes/lesson-3.jpg)

> [Nitya Narasimhan](https://github.com/nitya) 的草图笔记。单击图像可查看更大的版本。

本课程是 [Microsoft Reactor](https://developer.microsoft.com/reactor/?WT.mc_id=academic-17441-jabenn) 的 [Hello IoT 系列](https://youtube.com/playlist?list=PLmsFUfdnGr3xRts0TIwyaHyQuHaNQcb6-) 的一部分。本课程以 2 个视频的形式进行授课 - 一个 1 小时的课程，以及一个 1 小时的办公时间，深入探讨课程的各个部分并回答问题。

[![第 3 课：使用传感器和执行器与物理世界交互](https://img.youtube.com/vi/Lqalu1v6aF4/0.jpg)](https://youtu.be/Lqalu1v6aF4)

[![第 3 课：使用传感器和执行器与物理世界交互 - 办公时间](https://img.youtube.com/vi/qR3ekcMlLWA/0.jpg)](https://youtu.be/qR3ekcMlLWA)

> 🎥 点击上图观看视频

## 课前测验

[课前测验](https://black-meadow-040d15503.1.azurestaticapps.net/quiz/5)

## 简介

本课程介绍 IoT 设备的两个重要概念 - 传感器和执行器。您还将亲身体验它们，在您的 IoT 项目中添加光传感器，然后添加由光强度控制的 LED，从而有效地构建夜灯。

在本课中，我们将介绍：

* [什么是传感器？](#what-are-sensors)
* [使用传感器](#use-a-sensor)
* [传感器类型](#传感器类型)
* [什么是执行器？](#什么是执行器)
* [使用执行器](#use-an-actuator)
* [执行器类型](#actuator-types)

## 什么是传感器？

传感器是感知物理世界的硬件设备 - 也就是说，它们测量周围的一个或多个属性并将信息发送到物联网设备。传感器覆盖范围广泛的设备，因为可以测量的事物非常多，从气温等自然属性到运动等物理相互作用。

一些常见的传感器包括：

* 温度传感器 - 这些传感器感测空气温度或它们所浸入的物体的温度。对于业余爱好者和开发人员来说，这些传感器通常与气压和湿度结合在一个传感器中。
* 按钮 - 这些按钮在被按下时会产生感应。
* 光传感器 - 这些传感器检测光水平，可用于特定颜色、紫外线、红外线或一般可见光。
* 相机 - 通过拍照或流媒体视频来感知世界的视觉呈现。
* 加速度计 - 这些传感器可感知多个方向的运动。
* 麦克风 - 这些感知声音，无论是一般声级还是定向声音。

✅ 做一些研究。您的手机有哪些传感器？

所有传感器都有一个共同点——它们将感知到的任何内容转换为可由物联网设备解释的电信号。如何解释该电信号取决于传感器以及用于与物联网设备通信的通信协议。

## 使用传感器

请按照以下相关指南将传感器添加到您的 IoT 设备：

* [Arduino - Wio 终端](../wio-terminal-sensor.md)
* [单板计算机-Raspberry Pi](../pi-sensor.md)
* [单板机-虚拟设备](../virtual-device-sensor.md)

## 传感器类型

传感器可以是模拟传感器，也可以是数字传感器。

### 模拟传感器

一些最基本的传感器是模拟传感器。这些传感器从物联网设备接收电压，传感器组件调整该电压，并测量从传感器返回的电压以给出传感器值。

> 🎓 电压是衡量将电力从一个地方转移到另一个地方（例如从电池的正极端子到负极端子）所需的推动力的指标。例如，标准 AA 电池的电压为 1.5V（V是伏特的符号），可以以 1.5V 的力将电流从正极推向负极。不同的电气硬件需要不同的电压才能工作，例如，LED 可以在 2-3V 之间点亮，但 100W 的灯丝灯泡则需要 240V。您可以在[维基百科上的电压页面](https://wikipedia.org/wiki/Voltage) 上阅读有关电压的更多信息。

其中一个例子是电位计。这是一个可以在两个位置之间旋转的转盘，传感器可以测量旋转情况。

![电位计设置为中点，发送 5 伏电压，返回 3.8 伏电压](../../../../images/potentiometer.png)

IoT 设备将以 5 伏 (5V) 等电压向电位计发送电信号。当调节电位器时，它会改变另一侧输出的电压。想象一下，您有一个标记为从 0 到 [11](https://wikipedia.org/wiki/Up_to_eleven) 的刻度盘的电位计，例如放大器上的音量旋钮。当电位计处于完全关闭位置 (0) 时，将输出 0V（0 伏）。当它处于全开位置 (11) 时，将输出 5V（5 伏）。

> 🎓 这是过于简单化的说法，您可以在[电位器维基百科页面](https://wikipedia.org/wiki/Potentiometer) 上阅读有关电位器和可变电阻器的更多信息。

然后物联网设备读取传感器发出的电压，并且设备可以对其做出响应。根据传感器的不同，该电压可以是任意值，也可以映射到标准单位。例如，基于热敏电阻的模拟温度传感器会根据温度改变其电阻。然后可以通过代码计算将输出电压转换为以开尔文为单位的温度，并相应地转换为 °C 或 °F。

✅ 如果传感器返回的电压高于发送的电压（例如来自外部电源），您认为会发生什么？⛔️ 不要测试这个。

#### 模数转换

物联网设备是数字的 - 它们不能使用模拟值，只能使用 0 和 1。这意味着模拟传感器值需要先转换为数字信号才能进行处理。许多物联网设备都具有模数转换器 (ADCs)，可将模拟输入转换为其值的数字表示形式。传感器还可以通过连接器板与 ADCs 配合使用。例如，在带有 Raspberry Pi 的 Seeed Grove 生态系统中，模拟传感器连接到位于 Pi 上的`帽子`上的特定端口，该帽子连接到 Pi 的 GPIO 引脚，并且该帽子具有一个 ADC，可将电压转换为数字信号可以从 Pi 的 GPIO 引脚发送。

想象一下，您有一个连接到使用 3.3V 电压并返回 1V 值的 IoT 设备的模拟光传感器。这个 1V 在数字世界中没有任何意义，所以需要进行转换。电压将根据设备和传感器使用比例转换为模拟值。Seeed Grove 光传感器就是一个示例，其输出值从 0 到 1,023。对于以 3.3V 运行的传感器，1V 输出的值为 300。物联网设备无法将 300 作为模拟值处理，因此该值将转换为 `0000000100101100`，即 Grove 的 300 的二进制表示形式帽子。然后，这将由物联网设备进行处理。

✅ 如果您不了解二进制，请进行少量研究以了解数字如何由 0 和 1 表示。[BBC Bitesize 二进制简介课程](https://www.bbc.co.uk/bitesize/guides/zwsbwmn/revision/1) 是一个很好的起点。

从编码的角度来看，所有这些通常都是由传感器附带的库处理的，因此您不需要自己担心这种转换。对于 Grove 光传感器，您可以使用 Python 库并调用 `light` 属性，或者使用 Arduino 库并调用 `analogRead` 来获取值 300。

### 数字传感器

数字传感器与模拟传感器一样，利用电压的变化来检测周围的世界。不同之处在于它们通过仅测量两种状态或使用内置 ADC 来输出数字信号。数字传感器变得越来越普遍，以避免在连接器板或物联网设备本身上使用 ADC。

最简单的数字传感器是按钮或开关。这是一个具有两种状态的传感器：开或关。

![按钮发送 5 伏电压。未按下时返回 0 伏，按下时返回 5 伏](../../../../images/button.png)

物联网设备上的引脚如GPIO引脚可以直接测量该信号为0或1。如果发送的电压与返回的电压相同，则读取的值为1，否则读取的值为0。无需转换信号，只能是1或0。

> 💁 电压从来都不是精确的，特别是因为传感器中的组件会有一些电阻，因此通常存在公差。例如，Raspberry Pi 上的 GPIO 引脚工作在 3.3V，读取返回信号高于 1.8V 为 1，低于 1.8V 为 0。

* 3.3V 输入按钮。按钮关闭，因此输出 0V，给出值为 0
* 3.3V 输入按钮。按钮打开，输出 3.3V，值为 1

更先进的数字传感器读取模拟值，然后使用板载 ADC 将其转换为数字信号。例如，数字温度传感器仍然会像模拟传感器一样使用热电偶，并且仍然会测量当前温度下热电偶电阻引起的电压变化。传感器内置的 ADC 不会返回模拟值并依赖设备或连接器板转换为数字信号，而是会转换该值并将其作为一系列 0 和 1 发送到 IoT 设备。这些 0 和 1 的发送方式与按钮的数字信号相同，1 表示全电压，0 表示 0v。

![数字温度传感器将模拟读数转换为二进制数据，0 表示 0 伏，1 表示 5 伏，然后将其发送到 IoT 设备](../../../../images/temperature-as-digital.png)

发送数字数据使传感器变得更加复杂并发送更详细的数据，甚至是用于安全传感器的加密数据。一个例子是相机。这是一种传感器，可捕获图像并将其作为包含该图像的数字数据发送，通常采用压缩格式（例如 JPEG），以供 IoT 设备读取。它甚至可以通过捕获图像并逐帧发送完整图像或压缩视频流来流式传输视频。

## 什么是执行器？

执行器与传感器相反 - 它们将来自物联网设备的电信号转换为与物理世界的交互，例如发出光或声音，或移动电机。

一些常见的执行器包括：

* LED - 打开时会发光
* 扬声器 - 它们根据发送给它们的信号发出声音，从基本的蜂鸣器到可以播放音乐的音频扬声器
* 步进电机 - 将信号转换为指定的旋转量，例如将转盘旋转 90°
* 继电器 - 这些是可以通过电信号打开或关闭的开关。它们允许物联网设备的小电压开启更大的电压。
* 屏幕 - 这些是更复杂的执行器，并在多段显示器上显示信息。屏幕种类繁多，从简单的 LED 显示屏到高分辨率视频监视器。

✅ 做一些研究。您的手机有哪些执行器？

## 使用执行器

请按照以下相关指南向您的 IoT 设备添加由传感器控制的执行器，以构建 IoT 夜灯。它会从光传感器收集光强度，并在检测到的光强度太低时使用 LED 形式的执行器发光。

![分配的流程图，显示正在读取和检查的光级别，以及开始控制 LED](../../../../images/assignment-1-flow.png)

* [Arduino - Wio 终端](wio-terminal-actuator.md)
* [单板计算机-Raspberry Pi](pi-actuator.md)
* [单板机-虚拟设备](virtual-device-actuator.md)

## 执行器类型

与传感器一样，执行器也可以是模拟的或数字的。

### 模拟执行器

模拟执行器获取模拟信号并将其转换为某种交互，其中交互根据所提供的电压而变化。

一个例子是可调光灯，例如您家里可能有的灯。提供给灯的电压大小决定了它的亮度。

![灯在低电压下变暗，在高电压下变亮](../../../../images/dimmable-light.png)

与传感器一样，实际的物联网设备使用数字信号，而不是模拟信号。这意味着要发送模拟信号，物联网设备需要数模转换器 (DAC)，可以直接在物联网设备上，也可以在连接器板上。这会将 IoT 设备中的 0 和 1 转换为执行器可以使用的模拟电压。

✅ 如果物联网设备发送的电压高于执行器可以处理的电压，您认为会发生什么？
⛔️ 不要测试这个。

#### 脉冲宽度调制

将数字信号从物联网设备转换为模拟信号的另一种选择是脉宽调制。这涉及发送大量短数字脉冲，就像模拟信号一样。

例如，您可以使用 PWM 来控制电机的速度。

想象一下您正在控制一个 5V 电源的电机。您向电机发送一个短脉冲，将电压切换到高电压 (5V)，持续百分之二秒 (0.02s)。届时，您的电机可以旋转十分之一圈，即 36°。然后信号暂停百分之二秒 (0.02s)，发送低信号 (0V)。每个开关周期持续0.04秒。然后重复该循环。

![电机以 150 RPM 的脉宽调制旋转](../../../../images/pwm-motor-150rpm.png)

这意味着在一秒钟内有 25 个 0.02 秒的 5V 脉冲来旋转电机，每个脉冲之后都有 0.02 秒的 0V 暂停，不旋转电机。每个脉冲使电机旋转十分之一圈，这意味着电机每秒完成 2.5 圈。您使用数字信号使电机以每秒 2.5 转或 150 转/分钟的速度旋转（旋转速度的非标准测量）。

````输出
每秒 25 个脉冲 x 每个脉冲 0.1 转 = 每秒 2.5 转
每秒 2.5 转 x 每分钟 60 秒 = 150rpm
````

> 🎓 当 PWM 信号打开一半时间，关闭一半时间时，称为 [50% 占空比](https://wikipedia.org/wiki/Duty_cycle)。占空比以信号处于开启状态与关闭状态的时间百分比来衡量。

![电机在 75 RPM 下的脉宽调制旋转](../../../../images/pwm-motor-75rpm.png) 

您可以通过改变脉冲的大小来改变电机速度。例如，使用相同的电机，您可以保持 0.04 秒的相同循环时间，其中开启脉冲减半为 0.01 秒，关闭脉冲增加到 0.03 秒。每秒的脉冲数相同 (25)，但每个脉冲的长度是一半。半长脉冲仅使电机转动二十分之一转，每秒 25 个脉冲将完成每秒 1.25 转或 75rpm。通过改变数字信号的脉冲速度，您可以将模拟电机的速度减半。

````输出
每秒 25 个脉冲 x 每个脉冲 0.05 转 = 每秒 1.25 转
每秒 1.25 转 x 每分钟 60 秒 = 75rpm
````

✅ 如何保持电机旋转平稳，尤其是在低速时？您会使用少量带有长暂停的长脉冲还是大量带有很短暂停的短脉冲？

> 💁 一些传感器还使用 PWM 将模拟信号转换为数字信号。

> 🎓 您可以在[维基百科上的脉冲宽度调制页面](https://wikipedia.org/wiki/Pulse-width_modulation) 上阅读有关脉冲宽度调制的更多信息。

### 数字执行器

数字执行器与数字传感器一样，要么具有由高电压或低电压控制的两种状态，要么内置 DAC，因此可以将数字信号转换为模拟信号。

LED 是一种简单的数字执行器。当设备发送数字信号 1 时，会发送高电压来点亮 LED。当发送数字信号 0 时，电压降至 0V，LED 熄灭。

![LED 在 0 伏时关闭，在 5V 时打开](../../../../images/led.png)

✅ 您还能想到其他哪些简单的二态执行器？一个例子是螺线管，它是一种电磁体，可以激活它来执行诸如移动门栓锁定/解锁门之类的操作。

更先进的数字执行器（例如屏幕）需要以某些格式发送数字数据。它们通常附带库，可以更轻松地发送正确的数据来控制它们。

---

## 🚀 挑战

过去两节课的挑战是列出尽可能多的家庭、学校或工作场所中的物联网设备，并确定它们是围绕微控制器还是单板计算机构建，甚至是两者的混合构建。

对于您列出的每个设备，它们连接到哪些传感器和执行器？连接到这些设备的每个传感器和执行器的用途是什么？

## 课后测验

[课后测验](https://black-meadow-040d15503.1.azurestaticapps.net/quiz/6)

## 复习与自学

* 在 [ThingLearn](http://thinglearn.jenlooper.com/curriculum/) 上阅读有关电力和电路的内容。
* 有关不同类型温度传感器的信息，请参阅 [Seeed Studios 温度传感器指南](https://www.seeedstudio.com/blog/2019/10/14/Temperature-sensors-for-arduino-projects/)
* 在 [Wikipedia LED 页面](https://wikipedia.org/wiki/Light-emitting_diode) 上了解有关 LED 的信息

## 任务

[研究传感器和执行器](../taskment.md)
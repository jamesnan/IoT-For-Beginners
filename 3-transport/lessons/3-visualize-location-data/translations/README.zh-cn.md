# å¯è§†åŒ–ä½ç½®æ•°æ®

![æœ¬è¯¾çš„ sketchnote æ¦‚è¿°](../../../../sketchnotes/lesson-13.jpg)

> [Nitya Narasimhan](https://github.com/nitya) çš„è‰å›¾ç¬”è®°ã€‚ å•å‡»å›¾åƒå¯æŸ¥çœ‹æ›´å¤§çš„ç‰ˆæœ¬ã€‚

æœ¬è§†é¢‘æ¦‚è¿°äº† Azure Maps with IoTï¼Œè¿™æ˜¯æœ¬è¯¾ç¨‹å°†ä»‹ç»çš„ä¸€é¡¹æœåŠ¡ã€‚

[![Azure Maps - Microsoft Azure ä¼ä¸šå®šä½å¹³å°](https://img.youtube.com/vi/P5i2GFTtb2s/0.jpg)](https://www.youtube.com/watch?v=P5i2GFTtb2s)

> ğŸ¥ ç‚¹å‡»ä¸Šå›¾è§‚çœ‹è§†é¢‘

## è¯¾å‰æµ‹éªŒ

[è¯¾å‰æµ‹éªŒ](https://black-meadow-040d15503.1.azurestaticapps.net/quiz/25)

## ä»‹ç»

åœ¨ä¸Šä¸€è¯¾ä¸­ï¼Œæ‚¨å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨æ— æœåŠ¡å™¨ä»£ç ä»ä¼ æ„Ÿå™¨è·å– GPS æ•°æ®ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°äº‘å­˜å‚¨å®¹å™¨ä¸­ã€‚ ç°åœ¨æ‚¨å°†äº†è§£å¦‚ä½•åœ¨ Azure åœ°å›¾ä¸Šå¯è§†åŒ–è¿™äº›ç‚¹ã€‚ æ‚¨å°†å­¦ä¹ å¦‚ä½•åœ¨ç½‘é¡µä¸Šåˆ›å»ºåœ°å›¾ã€äº†è§£ GeoJSON æ•°æ®æ ¼å¼ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒåœ¨åœ°å›¾ä¸Šç»˜åˆ¶æ‰€æœ‰æ•è·çš„ GPS ç‚¹ã€‚

åœ¨æœ¬è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ï¼š

* [ä»€ä¹ˆæ˜¯æ•°æ®å¯è§†åŒ–](#ä»€ä¹ˆæ˜¯æ•°æ®å¯è§†åŒ–)
* [åœ°å›¾æœåŠ¡](#map-services)
* [åˆ›å»º Azure Maps èµ„æº](#create-an-azure-maps-resource)
* [åœ¨ç½‘é¡µä¸Šæ˜¾ç¤ºåœ°å›¾](#show-a-map-on-a-web-page)
* [GeoJSON æ ¼å¼](#the-geojson-format)
* [ä½¿ç”¨ GeoJSON åœ¨åœ°å›¾ä¸Šç»˜åˆ¶ GPS æ•°æ®](#plot-gps-data-on-a-map-using-geojson)

> ğŸ’ æœ¬è¯¾å°†æ¶‰åŠå°‘é‡ HTML å’Œ JavaScriptã€‚ å¦‚æœæ‚¨æƒ³äº†è§£æœ‰å…³ä½¿ç”¨ HTML å’Œ JavaScript è¿›è¡Œ Web å¼€å‘çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹[åˆå­¦è€… Web å¼€å‘](https://github.com/microsoft/Web-Dev-For-Beginners)ã€‚

## ä»€ä¹ˆæ˜¯æ•°æ®å¯è§†åŒ–

æ•°æ®å¯è§†åŒ–ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä»¥æ›´æ˜“äºäººç±»ç†è§£çš„æ–¹å¼å°†æ•°æ®å¯è§†åŒ–ã€‚ å®ƒé€šå¸¸ä¸å›¾è¡¨å’Œå›¾å½¢ç›¸å…³ï¼Œä½†æ˜¯ä»¥å›¾å½¢æ–¹å¼è¡¨ç¤ºæ•°æ®çš„ä»»ä½•æ–¹å¼ï¼Œä»¥å¸®åŠ©äººä»¬ä¸ä»…æ›´å¥½åœ°ç†è§£æ•°æ®ï¼Œè€Œä¸”å¸®åŠ©ä»–ä»¬åšå‡ºå†³ç­–ã€‚

ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ - å›åˆ°å†œåœºé¡¹ç›®ä¸­ï¼Œæ‚¨æ•è·äº†åœŸå£¤æ¹¿åº¦è®¾ç½®ã€‚ 2021 å¹´ 6 æœˆ 1 æ—¥æ¯å°æ—¶æ•è·çš„åœŸå£¤æ¹¿åº¦æ•°æ®è¡¨å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š

| Date             | Reading |
| ---------------- | ------: |
| 01/06/2021 00:00 |     257 |
| 01/06/2021 01:00 |     268 |
| 01/06/2021 02:00 |     295 |
| 01/06/2021 03:00 |     305 |
| 01/06/2021 04:00 |     325 |
| 01/06/2021 05:00 |     359 |
| 01/06/2021 06:00 |     398 |
| 01/06/2021 07:00 |     410 |
| 01/06/2021 08:00 |     429 |
| 01/06/2021 09:00 |     451 |
| 01/06/2021 10:00 |     460 |
| 01/06/2021 11:00 |     452 |
| 01/06/2021 12:00 |     420 |
| 01/06/2021 13:00 |     408 |
| 01/06/2021 14:00 |     431 |
| 01/06/2021 15:00 |     462 |
| 01/06/2021 16:00 |     432 |
| 01/06/2021 17:00 |     402 |
| 01/06/2021 18:00 |     387 |
| 01/06/2021 19:00 |     360 |
| 01/06/2021 20:00 |     358 |
| 01/06/2021 21:00 |     354 |
| 01/06/2021 22:00 |     356 |
| 01/06/2021 23:00 |     362 |


ä½œä¸ºäººç±»ï¼Œç†è§£æ•°æ®å¯èƒ½å¾ˆå›°éš¾ã€‚ è¿™æ˜¯ä¸€å µæ²¡æœ‰ä»»ä½•æ„ä¹‰çš„æ•°å­—å¢™ã€‚ ä½œä¸ºå¯è§†åŒ–æ­¤æ•°æ®çš„ç¬¬ä¸€æ­¥ï¼Œå¯ä»¥å°†å…¶ç»˜åˆ¶åœ¨æŠ˜çº¿å›¾ä¸Šï¼š

![ä¸Šè¿°æ•°æ®çš„æŠ˜çº¿å›¾](../../../../images/chart-soil-moisture.png)

é€šè¿‡æ·»åŠ ä¸€è¡Œæ¥æŒ‡ç¤ºè‡ªåŠ¨æµ‡æ°´ç³»ç»Ÿä½•æ—¶åœ¨åœŸå£¤æ¹¿åº¦è¯»æ•°ä¸º 450 æ—¶æ‰“å¼€ï¼Œå¯ä»¥è¿›ä¸€æ­¥å¢å¼ºæ­¤åŠŸèƒ½ï¼š

![450 å¤„çš„åœŸå£¤æ¹¿åº¦æŠ˜çº¿å›¾](../../../../images/chart-soil-moisture-relay.png)

è¯¥å›¾è¡¨ä¸ä»…å¯ä»¥å¿«é€Ÿæ˜¾ç¤ºåœŸå£¤æ¹¿åº¦æ°´å¹³ï¼Œè¿˜å¯ä»¥æ˜¾ç¤ºæµ‡æ°´ç³»ç»Ÿæ‰“å¼€çš„ç‚¹ã€‚

å›¾è¡¨å¹¶ä¸æ˜¯å¯è§†åŒ–æ•°æ®çš„å”¯ä¸€å·¥å…·ã€‚ è·Ÿè¸ªå¤©æ°”çš„ç‰©è”ç½‘è®¾å¤‡å¯ä»¥æ‹¥æœ‰ä½¿ç”¨ç¬¦å·å¯è§†åŒ–å¤©æ°”çŠ¶å†µçš„ç½‘ç»œåº”ç”¨ç¨‹åºæˆ–ç§»åŠ¨åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚è¡¨ç¤ºé˜´å¤©çš„äº‘ç¬¦å·ã€è¡¨ç¤ºé›¨å¤©çš„é›¨äº‘ç¬¦å·ç­‰ã€‚ å¯è§†åŒ–æ•°æ®çš„æ–¹æ³•æœ‰å¾ˆå¤šç§ï¼Œæœ‰å¾ˆå¤šå¾ˆä¸¥è‚ƒï¼Œä¹Ÿæœ‰ä¸€äº›å¾ˆæœ‰è¶£ã€‚

âœ… æƒ³æƒ³æ‚¨æ‰€çœ‹åˆ°çš„æ•°æ®å¯è§†åŒ–çš„æ–¹å¼ã€‚ å“ªäº›æ–¹æ³•æœ€æ¸…æ™°å¹¶ä¸”å¯ä»¥è®©æ‚¨æœ€å¿«åœ°åšå‡ºå†³ç­–ï¼Ÿ

æœ€å¥½çš„å¯è§†åŒ–å¯ä»¥è®©äººç±»å¿«é€Ÿåšå‡ºå†³ç­–ã€‚ ä¾‹å¦‚ï¼Œæœ‰ä¸€å µä»ªè¡¨å¢™æ˜¾ç¤ºå·¥ä¸šæœºæ¢°çš„å„ç§è¯»æ•°å¾ˆéš¾å¤„ç†ï¼Œä½†æ˜¯å½“å‡ºç°é—®é¢˜æ—¶é—ªçƒçš„çº¢ç¯å¯ä»¥è®©äººä»¬åšå‡ºå†³å®šã€‚ æœ‰æ—¶æœ€å¥½çš„å¯è§†åŒ–æ˜¯é—ªçƒçš„ç¯å…‰ï¼

ä½¿ç”¨ GPS æ•°æ®æ—¶ï¼Œæœ€æ¸…æ™°çš„å¯è§†åŒ–æ˜¯å°†æ•°æ®ç»˜åˆ¶åœ¨åœ°å›¾ä¸Šã€‚ ä¾‹å¦‚ï¼Œæ˜¾ç¤ºé€è´§å¡è½¦çš„åœ°å›¾å¯ä»¥å¸®åŠ©åŠ å·¥å‚çš„å·¥äººäº†è§£å¡è½¦ä½•æ—¶åˆ°è¾¾ã€‚ å¦‚æœè¿™å¼ åœ°å›¾ä¸ä»…æ˜¾ç¤ºäº†å¡è½¦å½“å‰ä½ç½®çš„å›¾ç‰‡ï¼Œè€Œä¸”è¿˜æä¾›äº†å¡è½¦å†…è´§ç‰©çš„æ¦‚å¿µï¼Œé‚£ä¹ˆå·¥å‚çš„å·¥äººå°±å¯ä»¥åšå‡ºç›¸åº”çš„è®¡åˆ’ - å¦‚æœä»–ä»¬çœ‹åˆ°é™„è¿‘æœ‰ä¸€è¾†å†·è—å¡è½¦ï¼Œä»–ä»¬å°±çŸ¥é“è¦å‡†å¤‡ç©ºé—´ å†°ç®±ã€‚

## åœ°å›¾æœåŠ¡

ä½¿ç”¨åœ°å›¾æ˜¯ä¸€é¡¹æœ‰è¶£çš„ç»ƒä¹ ï¼Œæœ‰å¾ˆå¤šåœ°å›¾å¯ä¾›é€‰æ‹©ï¼Œä¾‹å¦‚ Bing åœ°å›¾ã€Leafletã€Open Street Maps å’Œ Google åœ°å›¾ã€‚ åœ¨æœ¬è¯¾ä¸­ï¼Œæ‚¨å°†å­¦åˆ°æœ‰å…³ [Azure åœ°å›¾](https://azure.microsoft.com/services/azure-maps/?WT.mc_id=academic-17441-jabenn) ä»¥åŠå®ƒä»¬å¦‚ä½•æ˜¾ç¤ºæ‚¨çš„ GPS æ•°æ®ã€‚

![Azure Maps å¾½æ ‡](../../../../images/azure-maps-logo.png)

Azure Maps æ˜¯â€œåœ°ç†ç©ºé—´æœåŠ¡å’Œ SDK çš„é›†åˆï¼Œå®ƒä»¬ä½¿ç”¨æ–°çš„åœ°å›¾æ•°æ®ä¸º Web å’Œç§»åŠ¨åº”ç”¨ç¨‹åºæä¾›åœ°ç†ä¸Šä¸‹æ–‡ã€‚â€ å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨å·¥å…·æ¥åˆ›å»ºç²¾ç¾çš„äº¤äº’å¼åœ°å›¾ï¼Œè¿™äº›åœ°å›¾å¯ä»¥æä¾›æ¨èçš„äº¤é€šè·¯çº¿ã€æä¾›æœ‰å…³äº¤é€šäº‹ä»¶çš„ä¿¡æ¯ã€å®¤å†…å¯¼èˆªã€æœç´¢åŠŸèƒ½ã€æµ·æ‹”ä¿¡æ¯ã€å¤©æ°”æœåŠ¡ç­‰ã€‚

âœ… å°è¯•ä¸€äº›[æ˜ å°„ä»£ç ç¤ºä¾‹](https://docs.microsoft.com/samples/browse?WT.mc_id=academic-17441-jabenn&products=azure-maps)

æ‚¨å¯ä»¥å°†åœ°å›¾æ˜¾ç¤ºä¸ºç©ºç™½ç”»å¸ƒã€å›¾å—ã€å«æ˜Ÿå›¾åƒã€å åŠ é“è·¯çš„å«æ˜Ÿå›¾åƒã€å„ç§ç±»å‹çš„ç°åº¦åœ°å›¾ã€å¸¦æœ‰é˜´å½±æµ®é›•çš„åœ°å›¾ä»¥æ˜¾ç¤ºé«˜ç¨‹ã€å¤œæ™¯åœ°å›¾å’Œé«˜å¯¹æ¯”åº¦åœ°å›¾ã€‚ æ‚¨å¯ä»¥é€šè¿‡å°†åœ°å›¾ä¸ [Azure äº‹ä»¶ç½‘æ ¼](https://azure.microsoft.com/services/event-grid/?WT.mc_id=academic-17441-jabenn) é›†æˆæ¥è·å–åœ°å›¾çš„å®æ—¶æ›´æ–°ã€‚ æ‚¨å¯ä»¥é€šè¿‡å¯ç”¨å„ç§æ§ä»¶æ¥æ§åˆ¶åœ°å›¾çš„è¡Œä¸ºå’Œå¤–è§‚ï¼Œä»¥ä½¿åœ°å›¾èƒ½å¤Ÿå¯¹æåˆã€æ‹–åŠ¨å’Œå•å‡»ç­‰äº‹ä»¶åšå‡ºååº”ã€‚ è¦æ§åˆ¶åœ°å›¾çš„å¤–è§‚ï¼Œæ‚¨å¯ä»¥æ·»åŠ åŒ…å«æ°”æ³¡ã€çº¿æ¡ã€å¤šè¾¹å½¢ã€çƒ­å›¾ç­‰çš„å›¾å±‚ã€‚ æ‚¨å®ç°å“ªç§é£æ ¼çš„åœ°å›¾å–å†³äºæ‚¨é€‰æ‹©çš„ SDKã€‚

æ‚¨å¯ä»¥é€šè¿‡ [REST API](https://docs.microsoft.com/javascript/api/azure-maps-rest/?WT.mc_id=academic-17441-jabenn&view=azure-maps-typescript-latest) åŠå…¶ [Web SDK](https://docs.microsoft.com/azure/azure-maps/how-to-use-map-control?WT.mc_id=academic-17441-jabenn) æ¥è®¿é—® Azure Maps APIã€‚å¦‚æœæ‚¨æ­£åœ¨æ„å»ºä¸€ä¸ªç§»åŠ¨åº”ç”¨ç¨‹åºï¼ŒZåˆ™åˆ©ç”¨ [Android SDK](https://docs.microsoft.com/azure/azure-maps/how-to-use-android-map-control-library?WT.mc_id=academic-17441-jabenn&pivots=programming-language-java-android)ã€‚


åœ¨æœ¬è¯¾ç¨‹ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨ Web SDK ç»˜åˆ¶åœ°å›¾å¹¶æ˜¾ç¤ºä¼ æ„Ÿå™¨çš„ GPS ä½ç½®è·¯å¾„ã€‚

## åˆ›å»º Azure Maps èµ„æº

ç¬¬ä¸€æ­¥æ˜¯åˆ›å»º Azure Maps å¸æˆ·ã€‚

### ä»»åŠ¡ - åˆ›å»º Azure Maps èµ„æº

1. ä»ç»ˆç«¯æˆ–å‘½ä»¤æç¤ºç¬¦è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œåœ¨â€œgps-sensorâ€èµ„æºç»„ä¸­åˆ›å»º Azure Maps èµ„æºï¼š

    ```sh
    az maps account create --name gps-sensor \
                           --resource-group gps-sensor \
                           --accept-tos \
                           --sku S1
    ```

     è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸ºâ€œgps-sensorâ€çš„ Azure Maps èµ„æºã€‚ æ‰€ä½¿ç”¨çš„çº§åˆ«æ˜¯â€œS1â€ï¼Œè¿™æ˜¯ä¸€ä¸ªä»˜è´¹çº§åˆ«ï¼ŒåŒ…å«ä¸€ç³»åˆ—åŠŸèƒ½ï¼Œä½†æœ‰å¤§é‡å…è´¹é€šè¯ã€‚

     > ğŸ’ è¦æŸ¥çœ‹ä½¿ç”¨ Azure Maps çš„è´¹ç”¨ï¼Œè¯·æŸ¥çœ‹ [Azure Maps å®šä»·é¡µé¢](https://azure.microsoft.com/pricing/details/azure-maps/?WT.mc_id=academic-17441-jabenn) ã€‚

1. æ‚¨éœ€è¦åœ°å›¾èµ„æºçš„ API å¯†é’¥ã€‚ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è·å–æ­¤å¯†é’¥ï¼š

    ```sh
    az maps account keys list --name gps-sensor \
                              --resource-group gps-sensor \
                              --output table
    ```

     è·å–â€œPrimaryKeyâ€å€¼çš„å‰¯æœ¬ã€‚

## åœ¨ç½‘é¡µä¸Šæ˜¾ç¤ºåœ°å›¾

ç°åœ¨æ‚¨å¯ä»¥é‡‡å–ä¸‹ä¸€æ­¥ï¼Œå³åœ¨ç½‘é¡µä¸Šæ˜¾ç¤ºåœ°å›¾ã€‚ æˆ‘ä»¬å°†åªä¸ºæ‚¨çš„å°å‹ Web åº”ç”¨ç¨‹åºä½¿ç”¨ä¸€ä¸ªâ€œhtmlâ€æ–‡ä»¶ï¼› è¯·è®°ä½ï¼Œåœ¨ç”Ÿäº§æˆ–å›¢é˜Ÿç¯å¢ƒä¸­ï¼Œæ‚¨çš„ Web åº”ç”¨ç¨‹åºå¾ˆå¯èƒ½ä¼šæœ‰æ›´å¤šç§»åŠ¨éƒ¨ä»¶ï¼

### ä»»åŠ¡ - åœ¨ç½‘é¡µä¸Šæ˜¾ç¤ºåœ°å›¾

1. åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šçš„æŸä¸ªæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºindex.html çš„æ–‡ä»¶ã€‚ æ·»åŠ  HTML æ ‡è®°æ¥ä¿å­˜åœ°å›¾ï¼š

    ```html
    <html>
    <head>
        <style>
            #myMap {
                width:100%;
                height:100%;
            }
        </style>
    </head>
    
    <body onload="init()">
        <div id="myMap"></div>
    </body>
    </html>
    ```

     åœ°å›¾å°†åŠ è½½åˆ° `myMap` `div` ä¸­ã€‚ ä¸€äº›æ ·å¼å…è®¸å®ƒè·¨è¶Šé¡µé¢çš„å®½åº¦å’Œé«˜åº¦ã€‚

     > ğŸ“ `div` æ˜¯ç½‘é¡µä¸­å¯ä»¥å‘½åå’Œè®¾ç½®æ ·å¼çš„éƒ¨åˆ†ã€‚

1. åœ¨å¼€å§‹çš„ `<head>` æ ‡ç­¾ä¸‹ï¼Œæ·»åŠ å¤–éƒ¨æ ·å¼è¡¨æ¥æ§åˆ¶åœ°å›¾æ˜¾ç¤ºï¼Œå¹¶æ·»åŠ æ¥è‡ª Web SDK çš„å¤–éƒ¨è„šæœ¬æ¥ç®¡ç†å…¶è¡Œä¸ºï¼š

     ````html
     <link rel="stylesheet" href="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.css" type="text/css" />
     <script src="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.js"></script>
     ````

     è¯¥æ ·å¼è¡¨åŒ…å«åœ°å›¾å¤–è§‚çš„è®¾ç½®ï¼Œè„šæœ¬æ–‡ä»¶åŒ…å«åŠ è½½åœ°å›¾çš„ä»£ç ã€‚ æ·»åŠ æ­¤ä»£ç ç±»ä¼¼äºåŒ…å« C++ å¤´æ–‡ä»¶æˆ–å¯¼å…¥ Python æ¨¡å—ã€‚

1. åœ¨è¯¥è„šæœ¬ä¸‹ï¼Œæ·»åŠ è„šæœ¬å—ä»¥å¯åŠ¨åœ°å›¾ã€‚

    ```javascript
    <script type='text/javascript'>
        function init() {
            var map = new atlas.Map('myMap', {
                center: [-122.26473, 47.73444],
                zoom: 12,
                authOptions: {
                    authType: "subscriptionKey",
                    subscriptionKey: "<subscription_key>",

                }
            });
        }
    </script>
    ```

    å°† `<subscription_key>` æ›¿æ¢ä¸º Azure Maps å¸æˆ·çš„ API å¯†é’¥ã€‚

    å¦‚æœæ‚¨åœ¨ç½‘ç»œæµè§ˆå™¨ä¸­æ‰“å¼€ `index.html` é¡µé¢ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°åŠ è½½çš„åœ°å›¾ï¼Œå¹¶ä¸”é‡ç‚¹å…³æ³¨è¥¿é›…å›¾åœ°åŒºã€‚

    ![æ˜¾ç¤ºç¾å›½åç››é¡¿å·è¥¿é›…å›¾å¸‚çš„åœ°å›¾](../../../../images/map-image.png)

    âœ… å°è¯•ä½¿ç”¨ç¼©æ”¾å’Œä¸­å¿ƒå‚æ•°æ¥æ›´æ”¹åœ°å›¾æ˜¾ç¤ºã€‚ æ‚¨å¯ä»¥æ·»åŠ ä¸æ•°æ®çš„çº¬åº¦å’Œç»åº¦ç›¸å¯¹åº”çš„ä¸åŒåæ ‡ï¼Œä»¥é‡æ–°å±…ä¸­åœ°å›¾ã€‚

> ğŸ’ åœ¨æœ¬åœ°ä½¿ç”¨ Web åº”ç”¨ç¨‹åºçš„æ›´å¥½æ–¹æ³•æ˜¯å®‰è£… [http-server](https://www.npmjs.com/package/http-server)ã€‚ åœ¨ä½¿ç”¨æ­¤å·¥å…·ä¹‹å‰ï¼Œæ‚¨éœ€è¦å®‰è£… [node.js](https://nodejs.org/) å’Œ [npm](https://www.npmjs.com/)ã€‚ å®‰è£…è¿™äº›å·¥å…·åï¼Œæ‚¨å¯ä»¥å¯¼èˆªåˆ°â€œindex.htmlâ€æ–‡ä»¶çš„ä½ç½®å¹¶è¾“å…¥â€œhttp-serverâ€ã€‚ è¯¥ç½‘ç»œåº”ç”¨ç¨‹åºå°†åœ¨æœ¬åœ°ç½‘ç»œæœåŠ¡å™¨ [http://127.0.0.1:8080/](http://127.0.0.1:8080/) ä¸Šæ‰“å¼€ã€‚

## GeoJSON æ ¼å¼

ç°åœ¨æ‚¨å·²ç»æœ‰äº†å¯ä»¥æ˜¾ç¤ºåœ°å›¾çš„ Web åº”ç”¨ç¨‹åºï¼Œæ‚¨éœ€è¦ä»å­˜å‚¨å¸æˆ·ä¸­æå– GPS æ•°æ®å¹¶å°†å…¶æ˜¾ç¤ºåœ¨åœ°å›¾é¡¶éƒ¨çš„æ ‡è®°å±‚ä¸­ã€‚ åœ¨æ­¤ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ Azure Maps æ‰€éœ€çš„ [GeoJSON](https://wikipedia.org/wiki/GeoJSON) æ ¼å¼ã€‚

[GeoJSON](https://geojson.org/) æ˜¯ä¸€ç§å¼€æ”¾æ ‡å‡† JSON è§„èŒƒï¼Œå…·æœ‰ç‰¹æ®Šæ ¼å¼ï¼Œæ—¨åœ¨å¤„ç†ç‰¹å®šäºåœ°ç†çš„æ•°æ®ã€‚ æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨ [geojson.io](https://geojson.io) æµ‹è¯•ç¤ºä¾‹æ•°æ®æ¥äº†è§£å®ƒï¼Œè¿™ä¹Ÿæ˜¯è°ƒè¯• GeoJSON æ–‡ä»¶çš„æœ‰ç”¨å·¥å…·ã€‚

ç¤ºä¾‹ GeoJSON æ•°æ®å¦‚ä¸‹æ‰€ç¤ºï¼š

```json
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          -2.10237979888916,
          57.164918677004714
        ]
      }
    }
  ]
}
```

ç‰¹åˆ«æœ‰è¶£çš„æ˜¯æ•°æ®ä½œä¸º `Feature` åµŒå¥—åœ¨ `FeatureCollection` ä¸­çš„æ–¹å¼ã€‚ åœ¨è¯¥å¯¹è±¡ä¸­å¯ä»¥æ‰¾åˆ°â€œå‡ ä½•å›¾å½¢â€ï¼Œå…¶ä¸­â€œåæ ‡â€è¡¨ç¤ºçº¬åº¦å’Œç»åº¦ã€‚

âœ… æ„å»º geoJSON æ—¶ï¼Œè¯·æ³¨æ„å¯¹è±¡ä¸­ `çº¬åº¦` å’Œ `ç»åº¦` çš„é¡ºåºï¼Œå¦åˆ™æ‚¨çš„ç‚¹å°†ä¸ä¼šå‡ºç°åœ¨åº”æœ‰çš„ä½ç½®ï¼ GeoJSON æœŸæœ›æ•°æ®ç‚¹çš„é¡ºåºä¸º `lon,lat`ï¼Œè€Œä¸æ˜¯ `lat,lon`ã€‚

`å‡ ä½•å›¾å½¢` å¯ä»¥æœ‰ä¸åŒçš„ç±»å‹ï¼Œä¾‹å¦‚å•ä¸ªç‚¹æˆ–å¤šè¾¹å½¢ã€‚ åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå®ƒæ˜¯æŒ‡å®šäº†ä¸¤ä¸ªåæ ‡çš„ç‚¹ï¼šç»åº¦å’Œçº¬åº¦ã€‚

âœ… Azure Maps æ”¯æŒæ ‡å‡† GeoJSON ä»¥åŠä¸€äº›[å¢å¼ºåŠŸèƒ½](https://docs.microsoft.com/azure/azure-maps/extend-geojson?WT.mc_id=academic-17441-jabenn)ï¼ŒåŒ…æ‹¬ç»˜åˆ¶åœ†åœˆå’Œ å…¶ä»–å‡ ä½•å½¢çŠ¶ã€‚

## ä½¿ç”¨ GeoJSON åœ¨åœ°å›¾ä¸Šç»˜åˆ¶ GPS æ•°æ®

ç°åœ¨æ‚¨å·²å‡†å¤‡å¥½ä½¿ç”¨åœ¨ä¸Šä¸€è¯¾ç¨‹ä¸­æ„å»ºçš„å­˜å‚¨ä¸­çš„æ•°æ®ã€‚ æé†’ä¸€ä¸‹ï¼Œå®ƒä½œä¸ºå¤šä¸ªæ–‡ä»¶å­˜å‚¨åœ¨ Blob å­˜å‚¨ä¸­ï¼Œå› æ­¤æ‚¨éœ€è¦æ£€ç´¢æ–‡ä»¶å¹¶è§£æå®ƒä»¬ï¼Œä»¥ä¾¿ Azure Maps å¯ä»¥ä½¿ç”¨è¿™äº›æ•°æ®ã€‚

### ä»»åŠ¡ - é…ç½®å¯ä»ç½‘é¡µè®¿é—®çš„å­˜å‚¨

å¦‚æœæ‚¨è°ƒç”¨å­˜å‚¨æ¥è·å–æ•°æ®ï¼Œæ‚¨å¯èƒ½ä¼šæƒŠè®¶åœ°å‘ç°æµè§ˆå™¨æ§åˆ¶å°ä¸­å‡ºç°é”™è¯¯ã€‚ è¿™æ˜¯å› ä¸ºæ‚¨éœ€è¦ä¸ºæ­¤å­˜å‚¨è®¾ç½® [CORS](https://developer.mozilla.org/docs/Web/HTTP/CORS) æƒé™ï¼Œä»¥å…è®¸å¤–éƒ¨ Web åº”ç”¨ç¨‹åºè¯»å–å…¶æ•°æ®ã€‚

> ğŸ“ CORS ä»£è¡¨â€œè·¨æºèµ„æºå…±äº«â€ï¼Œå‡ºäºå®‰å…¨åŸå› é€šå¸¸éœ€è¦åœ¨ Azure ä¸­æ˜ç¡®è®¾ç½®ã€‚ å®ƒä¼šé˜»æ­¢æ‚¨ä¸æœŸæœ›çš„ç½‘ç«™è®¿é—®æ‚¨çš„æ•°æ®ã€‚

1. è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯ç”¨ CORSï¼š
   
    ```sh
    az storage cors add --methods GET \
                        --origins "*" \
                        --services b \
                        --account-name <storage_name> \
                        --account-key <key1>
    ```


    å°† `<storage_name>` æ›¿æ¢ä¸ºæ‚¨çš„å­˜å‚¨å¸æˆ·çš„åç§°ã€‚ å°† `<key1>` æ›¿æ¢ä¸ºæ‚¨çš„å­˜å‚¨å¸æˆ·çš„å¸æˆ·å¯†é’¥ã€‚

    æ­¤å‘½ä»¤å…è®¸ä»»ä½•ç½‘ç«™ï¼ˆé€šé…ç¬¦â€œ*â€è¡¨ç¤ºä»»æ„ï¼‰å‘å‡º *GET* è¯·æ±‚ï¼Œå³ä»æ‚¨çš„å­˜å‚¨å¸æˆ·è·å–æ•°æ®ã€‚ `--services b` è¡¨ç¤ºä»…å°†æ­¤è®¾ç½®åº”ç”¨äº blobã€‚

### ä»»åŠ¡ - ä»å­˜å‚¨åŠ è½½ GPS æ•°æ®

1. å°† `init` å‡½æ•°çš„å…¨éƒ¨å†…å®¹æ›¿æ¢ä¸ºä»¥ä¸‹ä»£ç ï¼š

    ```javascript
    fetch("https://<storage_name>.blob.core.windows.net/gps-data/?restype=container&comp=list")
        .then(response => response.text())
        .then(str => new window.DOMParser().parseFromString(str, "text/xml"))
        .then(xml => {
            let blobList = Array.from(xml.querySelectorAll("Url"));
                blobList.forEach(async blobUrl => {
                    loadJSON(blobUrl.innerHTML)                
        });
    })
    .then( response => {
        map = new atlas.Map('myMap', {
            center: [-122.26473, 47.73444],
            zoom: 14,
            authOptions: {
                authType: "subscriptionKey",
                subscriptionKey: "<subscription_key>",
    
            }
        });
        map.events.add('ready', function () {
            var source = new atlas.source.DataSource();
            map.sources.add(source);
            map.layers.add(new atlas.layer.BubbleLayer(source));
            source.add(features);
        })
    })
    ```

     å°† `<storage_name>` æ›¿æ¢ä¸ºæ‚¨çš„å­˜å‚¨å¸æˆ·çš„åç§°ã€‚ å°† `<subscription_key>` æ›¿æ¢ä¸º Azure Maps å¸æˆ·çš„ API å¯†é’¥ã€‚

     è¿™é‡Œå‘ç”Ÿäº†å‡ ä»¶äº‹ã€‚ é¦–å…ˆï¼Œä»£ç ä½¿ç”¨ä½¿ç”¨å­˜å‚¨å¸æˆ·åç§°æ„å»ºçš„ URL ç»ˆç»“ç‚¹ä» Blob å®¹å™¨ä¸­è·å– GPS æ•°æ®ã€‚ æ­¤ URL ä» `gps-data` æ£€ç´¢ï¼ŒæŒ‡ç¤ºèµ„æºç±»å‹æ˜¯å®¹å™¨ (`restype=container`)ï¼Œå¹¶åˆ—å‡ºæœ‰å…³æ‰€æœ‰ Blob çš„ä¿¡æ¯ã€‚ æ­¤åˆ—è¡¨ä¸ä¼šè¿”å› blob æœ¬èº«ï¼Œä½†ä¼šè¿”å›æ¯ä¸ª blob çš„ URLï¼Œå¯ç”¨äºåŠ è½½ blob æ•°æ®ã€‚

     > ğŸ’ æ‚¨å¯ä»¥å°†æ­¤ URL æ”¾å…¥æµè§ˆå™¨ä¸­ä»¥æŸ¥çœ‹å®¹å™¨ä¸­æ‰€æœ‰ Blob çš„è¯¦ç»†ä¿¡æ¯ã€‚ æ¯ä¸ªé¡¹ç›®éƒ½æœ‰ä¸€ä¸ª `Url` å±æ€§ï¼Œæ‚¨ä¹Ÿå¯ä»¥åœ¨æµè§ˆå™¨ä¸­åŠ è½½è¯¥å±æ€§ä»¥æŸ¥çœ‹ blob çš„å†…å®¹ã€‚

     ç„¶åï¼Œæ­¤ä»£ç åŠ è½½æ¯ä¸ª blobï¼Œè°ƒç”¨æ¥ä¸‹æ¥å°†åˆ›å»ºçš„ `loadJSON` å‡½æ•°ã€‚ ç„¶åï¼Œå®ƒåˆ›å»ºåœ°å›¾æ§ä»¶ï¼Œå¹¶å°†ä»£ç æ·»åŠ åˆ°â€œreadyâ€äº‹ä»¶ä¸­ã€‚ å½“åœ°å›¾æ˜¾ç¤ºåœ¨ç½‘é¡µä¸Šæ—¶è°ƒç”¨æ­¤äº‹ä»¶ã€‚

     å°±ç»ªäº‹ä»¶åˆ›å»ºä¸€ä¸ª Azure Maps æ•°æ®æº - ä¸€ä¸ªåŒ…å«ç¨åå°†å¡«å……çš„ GeoJSON æ•°æ®çš„å®¹å™¨ã€‚ ç„¶åä½¿ç”¨è¯¥æ•°æ®æºåˆ›å»ºä¸€ä¸ªæ°”æ³¡å±‚ - è¿™æ˜¯åœ°å›¾ä¸Šä»¥ GeoJSON ä¸­çš„æ¯ä¸ªç‚¹ä¸ºä¸­å¿ƒçš„ä¸€ç»„åœ†åœˆã€‚

1. å°† `loadJSON` å‡½æ•°æ·»åŠ åˆ°è„šæœ¬å—ä¸­ï¼Œä½äº `init` å‡½æ•°ä¸‹æ–¹ï¼š

    ```javascript
    var map, features;

    function loadJSON(file) {
        var xhr = new XMLHttpRequest();
        features = [];
        xhr.onreadystatechange = function () {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) {
                    gps = JSON.parse(xhr.responseText)
                    features.push(
                        new atlas.data.Feature(new atlas.data.Point([parseFloat(gps.gps.lon), parseFloat(gps.gps.lat)]))
                    )
                }
            }
        };
        xhr.open("GET", file, true);
        xhr.send();
    }    
    ```

    è¯¥å‡½æ•°ç”± fetch ä¾‹ç¨‹è°ƒç”¨ï¼Œä»¥è§£æ JSON æ•°æ®å¹¶å°†å…¶è½¬æ¢ä¸ºä»¥ geoJSON å½¢å¼è¯»å–çš„ç»åº¦å’Œçº¬åº¦åæ ‡ã€‚è§£æåï¼Œæ•°æ®å°†è¢«è®¾ç½®ä¸º geoJSONâ€œç‰¹å¾â€çš„ä¸€éƒ¨åˆ†ã€‚ åœ°å›¾å°†è¢«åˆå§‹åŒ–ï¼Œå¹¶ä¸”æ•°æ®ç»˜åˆ¶çš„è·¯å¾„å‘¨å›´å°†å‡ºç°å°æ°”æ³¡ï¼š

1. åœ¨æµè§ˆå™¨ä¸­åŠ è½½ HTML é¡µé¢ã€‚ å®ƒå°†åŠ è½½åœ°å›¾ï¼Œç„¶åä»å­˜å‚¨ä¸­åŠ è½½æ‰€æœ‰ GPS æ•°æ®å¹¶å°†å…¶ç»˜åˆ¶åœ¨åœ°å›¾ä¸Šã€‚

     ![è¥¿é›…å›¾é™„è¿‘çš„åœ£çˆ±å¾·åå·ç«‹å…¬å›­åœ°å›¾ï¼Œåœ†åœˆæ˜¾ç¤ºå…¬å›­è¾¹ç¼˜çš„è·¯å¾„](../../../../images/map-path.png)

> ğŸ’ æ‚¨å¯ä»¥åœ¨ [code](..//code) æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°æ­¤ä»£ç ã€‚

---

## ğŸš€ æŒ‘æˆ˜

èƒ½å¤Ÿåœ¨åœ°å›¾ä¸Šå°†é™æ€æ•°æ®æ˜¾ç¤ºä¸ºæ ‡è®°çœŸæ˜¯å¤ªå¥½äº†ã€‚ æ‚¨èƒ½å¦ä½¿ç”¨å¸¦æ—¶é—´æˆ³çš„ json æ–‡ä»¶å¢å¼ºæ­¤ Web åº”ç”¨ç¨‹åºä»¥æ·»åŠ åŠ¨ç”»å¹¶æ˜¾ç¤ºæ ‡è®°éšæ—¶é—´å˜åŒ–çš„è·¯å¾„ï¼Ÿ ä»¥ä¸‹æ˜¯åœ¨åœ°å›¾ä¸­ä½¿ç”¨åŠ¨ç”»çš„[ä¸€äº›ç¤ºä¾‹](https://azuremapscodesamples.azurewebsites.net/)ã€‚

## è¯¾åæµ‹éªŒ

[è¯¾åæµ‹éªŒ](https://black-meadow-040d15503.1.azurestaticapps.net/quiz/26)

## å¤ä¹ ä¸è‡ªå­¦

Azure Maps å¯¹äºä½¿ç”¨ IoT è®¾å¤‡ç‰¹åˆ«æœ‰ç”¨ã€‚

* ç ”ç©¶ [Microsoft æ–‡æ¡£ä¸Šçš„ Azure Maps æ–‡æ¡£](https://docs.microsoft.com/azure/azure-maps/tutorial-iot-hub-maps?WT.mc_id=academic-17441-jabenn)ã€‚
* é€šè¿‡ [ä½¿ç”¨ Microsoft Learn ä¸Šçš„ Azure Maps è‡ªåŠ©å­¦ä¹ æ¨¡å—åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªè·¯çº¿æŸ¥æ‰¾åº”ç”¨ç¨‹åº](https://docs.microsoft.com/learn/modules/create-your-first-app-with-azure-maps/?WT.mc_id=academic-17441-jabenn)ã€‚

## ä»»åŠ¡

[éƒ¨ç½²æ‚¨çš„åº”ç”¨ç¨‹åº](../assignment.md)                 
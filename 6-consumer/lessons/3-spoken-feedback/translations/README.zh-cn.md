
# 设置计时器并提供口头反馈

![本课的 sketchnote 概述](../../../../sketchnotes/lesson-23.jpg)

> [Nitya Narasimhan](https://github.com/nitya) 的草图笔记。单击图像查看放大版本。

## 课前测验

[课前测验](https://black-meadow-040d15503.1.azurestaticapps.net/quiz/45)

## 介绍

智能助手不是单向通信设备。你和他们说话，他们回应：

“Alexa，设置 3 分钟计时器”

“好的，您的计时器设置为 3 分钟”

在过去 2 节课程中，您学习了如何获取语音并创建文本，然后从该文本中提取设置的计时器请求。在本课程中，您将学习如何在物联网设备上设置计时器，用语音响应用户确认其计时器，并在计时器完成时提醒他们。

在本课中，我们将介绍：

* [文字转语音](#文字转语音)
* [设置计时器](#set-the-timer)
* [将文本转换为语音](#convert-text-to-speech)

## 文字转语音

文本转语音，顾名思义，是将文本转换为包含文本的音频的过程。基本原理是将文本中的单词分解为其组成的声音（称为音素），并使用预先录制的音频或使用人工智能模型生成的音频将这些声音拼接在一起。

![典型文本语音系统的三个阶段](../../../../images/tts-overview.png)

文本到语音系统通常有 3 个阶段：

* 文本分析
* 语言分析
* 波形生成

### 文本分析

文本分析涉及获取提供的文本，并将其转换为可用于生成语音的单词。例如，如果转换“Hello world”，则无需进行文本分析，这两个单词就可以转换为语音。但是，如果您有“1234”，则可能需要根据上下文将其转换为“一千，二百三十四”或“一，二，三，四”。对于“我有 1234 个苹果”，则为“一千二百三十四”，但对于“孩子数了 1234”则为“一、二、三、四”。

创建的单词不仅因语言而异，而且因该语言的区域设置而异。例如，在美式英语中，120 表示“一百二十”，在英式英语中表示“一百二十”，百位后使用“and”。

✅ 其他一些需要文本分析的示例包括“in”作为英寸的缩写形式，以及“st”作为圣人和街道的缩写形式。你能想出在你的语言中没有上下文就含糊不清的单词的其他例子吗？

一旦定义了单词，它们就会被发送进行语言分析。

### 语言分析

语言分析将单词分解为音素。音素不仅基于所使用的字母，还基于单词中的其他字母。例如，在英语中，“car”和“care”中的“a”发音是不同的。英语字母表中的 26 个字母有 44 个不同的音素，其中一些由不同的字母共享，例如“circle”和“serpent”开头使用的相同音素。

✅ 做一些研究：您的语言的音素是什么？

一旦单词被转换为音素，这些音素就需要额外的数据来支持语调，根据上下文调整语气或持续时间。一个例子是，在英语中，音调增加可用于将句子转换为问题，最后一个单词的音调升高意味着一个问题。

例如，“你有一个苹果”这句话是一个陈述，说你有一个苹果。如果最后音高升高，即“苹果”一词的音调升高，则它会变成问题“你有一个苹果吗？”，询问你是否有一个苹果。语言分析需要使用末尾的问号来决定增加音调。

一旦生成了音素，就可以将它们发送以进行波形生成以产生音频输出。

### 波形生成

第一个电子文本转语音系统对每个音素使用单个录音，导致声音非常单调、机械化。语言分析将产生音素，这些音素将从声音数据库中加载并缝合在一起以形成音频。

✅ 做一些研究：从早期语音合成系统中找到一些录音。将其与现代语音合成（例如智能助手中使用的语音合成）进行比较。

更现代的波形生成使用深度学习（非常大的神经网络，其作用方式与大脑中的神经元类似）构建的机器学习模型来产生更自然的声音，与人类的声音无法区分。

> 💁 其中一些 ML 模型可以使用迁移学习进行重新训练，听起来就像真人一样。这意味着使用语音作为安全系统（银行越来越多地尝试这样做）不再是一个好主意，因为任何拥有您几分钟语音录音的人都可以冒充您。

这些大型机器学习模型正在接受训练，将所有三个步骤组合到端到端语音合成器中。

## 设置计时器

要设置计时器，您的 IoT 设备需要调用您使用无服务器代码创建的 REST 端点，然后使用生成的秒数来设置计时器。

### 任务-调用serverless函数获取定时器时间

按照相关指南从 IoT 设备调用 REST 端点并设置所需时间的计时器：

* [Arduino - Wio 终端](../wio-terminal-set-timer.md)
* [单板计算机-Raspberry Pi/虚拟物联网设备](../single-board-computer-set-timer.md)

## 将文本转换为语音

您用于将语音转换为文本的相同语音服务也可用于将文本转换回语音，并且可以通过 IoT 设备上的扬声器播放。要转换的文本连同所需的音频类型（例如采样率）一起发送到语音服务，并返回包含音频的二进制数据。

当您发送此请求时，您可以使用*语音合成标记语言* (SSML) 来发送它，SSML 是一种用于语音合成应用程序的基于 XML 的标记语言。这不仅定义了要转换的文本，还定义了文本的语言、要使用的语音，甚至可以用于定义文本中部分或全部单词的速度、音量和音调。

例如，此 SSML 定义了一个请求，将文本“Your 3 分钟 5 秒时间已设置”转换为使用名为“en-GB-MiaNeural”的英式英语语音的语音

```xml

    
    
        您的 3 分 5 秒时间已设定
    
    

   
```

> 💁 大多数文本转语音系统都有针对不同语言的多种语音，并具有相关的口音，例如带有英国口音的英国英语语音和带有新西兰口音的新西兰英语语音。

### 任务 - 将文本转换为语音

完成相关指南，使用 IoT 设备将文本转换为语音：

* [Arduino - Wio 终端](../wio-terminal-text-to-speech.md)
* [单板计算机-Raspberry Pi](../pi-text-to-speech.md)
* [单板机-虚拟设备](../virtual-device-text-to-speech.md)

---

## 🚀 挑战

SSML 有多种方法可以改变单词的发音方式，例如强调某些单词、添加停顿或改变音调。尝试其中的一些，从 IoT 设备发送不同的 SSML 并比较输出。您可以阅读有关 SSML 的更多信息，包括如何在 [万维网联盟的语音合成标记语言 (SSML) 版本 1.1 规范](https://www.w3.org/TR/speech) 中更改单词的发音方式-合成11/)。

## 课后测验

[课后测验](https://black-meadow-040d15503.1.azurestaticapps.net/quiz/46)

## 复习与自学

* 在 [Wikipedia 上的语音合成页面](https://wikipedia.org/wiki/Speech_synthesis) 上了解有关语音合成的更多信息
* 详细了解犯罪分子利用语音合成进行盗窃的方式 [BBC 新闻中的假声音“帮助网络骗子窃取现金”故事](https://www.bbc.com/news/technology-48908736)
* 详细了解配音演员的声音合成版本所面临的风险，请参阅 [这篇 TikTok 诉讼强调了人工智能如何在 Vice 上搞砸配音演员的文章](https://www.vice.com/en/article/z3xqwj/this-tiktok-lawsuit-is-highlighting-how-ai-is-screwing-over-voice-actors)

## 任务

[取消定时器](../assignment.md)